---
title: "R Notebook"
output: html_notebook
---

```{r}
library(RMySQL)
library(DBI)

fpath = "./"
dbfile = "bird_strikes.db"
mydb <-  dbConnect(MySQL(), user = "root", password = '',
                 dbname = 'Practicum1', host = 'localhost', port = 3306)
```

# 1
```{sql connection=mydb}
CREATE TABLE airlines (
  airline VARCHAR(30) NOT NULL,
  code INT UNSIGNED,
  aid INT(6) UNSIGNED AUTO_INCREMENT,
  PRIMARY KEY (aid)
)
```
```{sql connection=mydb}
CREATE TABLE airports (
  pid INT(6) UNSIGNED AUTO_INCREMENT,
  code INT UNSIGNED,
  name VARCHAR(30) NOT NULL,
  city VARCHAR(20),
  state VARCHAR(20),
  country VARCHAR(20),
  PRIMARY KEY (pid)
)
```
```{sql connection=mydb}
DROP TABLE airports
```
```{sql connection=mydb}
CREATE TABLE incidents(
  iid INT(6) UNSIGNED AUTO_INCREMENT, 
  date DATE, 
  depPort INT(6) UNSIGNED, 
  arrPort INT(6) UNSIGNED, 
  airline INT(6) UNSIGNED, 
  aircraft VARCHAR(20), 
  flightPhase VARCHAR(20),
  CONSTRAINT check_phase CHECK (flightPhase IN ('takeoff', 'landing', 'inflight', 'unknown')),
  impact VARCHAR(40),
  PRIMARY KEY (iid),
  FOREIGN KEY (depPort) REFERENCES airports(pid),
  FOREIGN KEY (arrPort) REFERENCES airports(pid),
  FOREIGN KEY (airline) REFERENCES airlines(aid)
)
```

# 2
```{r}
df <- read.csv('./BirdStrikesData.csv')

incident_df = df[,c("Record.ID", "FlightDate", "Aircraft..Make.Model", "When..Phase.of.flight")]
colnames(incident_df) <- c('pid', 'name', 'aircraft', 'flightPhase')
gsub(incident_df$Date,pattern=" 0:00",replacement="")
dbWriteTable(mydb, name="incidents", value = incident_df, overwrite=TRUE, row.names = FALSE, field.types=c())

airport_df = unique(df[,c("Airport..Name", "Origin.State")])
airport_df$City <- NA
airport_df$Country <- "United States"
colnames(airport_df) <- c('Name', 'State', 'City', 'Country')
airport_df$code <- NA
airport_df$pid <- NA
dbWriteTable(mydb, name="airports", value = airport_df, append=TRUE, row.names = FALSE, field.types=c())


airlines <- unique(df$Aircraft..Airline.Operator)
airlines[airlines==""]<-'UNKNOWN'
airlines <- as.data.frame(airlines)
colnames(airlines) <- c('airline')
print(airlines)
airlines$code <- NA
airlines$aid <- NA
dbWriteTable(conn=mydb, name='airlines', value=airlines, append=TRUE, row.names=FALSE, field.types=c())

```
#3
```{r}
chk_airl <- dbGetQuery(mydb, 'select * from airlines limit 20')
print(chk_airl)

chk_airp <- dbGetQuery(mydb, 'select * from airports limit 20')
print(chk_airp)

chk_inc <- dbGetQuery(mydb, 'select * from incidents limit 20')
print(chk_inc)
```


