---
title: "R Notebook"
output: html_notebook
---

```{r}
library(RMySQL)
library(DBI)

fpath = "./"
dbfile = "bird_strikes.db"
mydb <-  dbConnect(MySQL(), user = "root", password = '',
                 dbname = 'Practicum1', host = 'localhost', port = 3306)
```

# 1
```{sql connection=mydb}
CREATE TABLE airlines (
  aid INT(6) UNSIGNED AUTO_INCREMENT,
  code INT UNSIGNED,
  airline VARCHAR(30) NOT NULL,
  PRIMARY KEY (aid)
)
```
```{sql connection=mydb}
CREATE TABLE airports (
  pid INT(6) UNSIGNED AUTO_INCREMENT,
  code INT UNSIGNED,
  name VARCHAR(30) NOT NULL,
  city VARCHAR(20),
  state VARCHAR(20),
  country VARCHAR(20),
  PRIMARY KEY (pid)
)
```
```{sql connection=mydb}
DROP TABLE incidents
```
```{sql connection=mydb}
CREATE TABLE incidents(
  iid INT(6) UNSIGNED AUTO_INCREMENT, 
  date DATE, 
  depPort INT(6) UNSIGNED, 
  arrPort INT(6) UNSIGNED, 
  airline INT(6) UNSIGNED, 
  aircraft VARCHAR(20), 
  flightPhase VARCHAR(20),
  CONSTRAINT check_phase CHECK (flightPhase IN ('takeoff', 'landing', 'inflight', 'unknown')),
  impact VARCHAR(40),
  PRIMARY KEY (iid),
  FOREIGN KEY (depPort) REFERENCES airports(pid),
  FOREIGN KEY (arrPort) REFERENCES airports(pid),
  FOREIGN KEY (airline) REFERENCES airlines(aid)
)
```

# 2
```{r}
df <- read.csv('./BirdStrikesData.csv')
airlines <- 
values &lt;- paste0(apply(airlines, 1, function(x) paste0("('", paste0(x, collapse = "', '"), "')")), collapse = ", ")
dbSendQuery(dcon, paste0("INSERT INTO blog__r_dataframe VALUES ", values, ";"))
```

